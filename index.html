<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Team Organization</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: #ffffff;
            color: #2c3e50;
            transition: background 0.3s;
        }
        .dark-mode {
            background: #333333;
            color: #d3d3d3;
        }
        header {
            position: sticky;
            top: 0;
            background: #8b0000;
            background-image: url('court.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            color: #ffffff;
            text-shadow: 1px 1px 1px rgba(44, 62, 80, 0.5);
        }
        header h1 {
            font-family: 'Wide Latin', serif;
            letter-spacing: 2px;
            font-size: 2.2em;
        }
        #hamburger {
            display: block;
            cursor: pointer;
            font-size: 24px;
            color: #ffffff;
        }
        nav { display: none; }
        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            background: #8b0000;
        }
        nav ul li { margin: 10px; }
        nav ul li a, nav ul li button {
            color: #ffffff;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s;
            text-shadow: 1px 1px 1px rgba(44, 62, 80, 0.5);
            background: none;
            border: none;
            font-size: 1em;
            cursor: pointer;
        }
        nav ul li a:hover, nav ul li button:hover { color: #d3d3d3; }
        section {
            display: none;
            padding: 20px;
            animation: fadeIn 0.5s;
            border: 1px solid #2c3e50;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card {
            background: #8b0000;
            border-radius: 10px;
            padding: 10px;
            margin: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: transform 0.3s;
            border: 2px solid #2c3e50;
            color: #ffffff;
        }
        .card:hover { transform: scale(1.05); }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        .youtube-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin: 20px 0;
            justify-content: center;
        }
        .youtube-video {
            flex: 1 1 300px;
            max-width: 500px;
            min-width: 280px;
            background: #000;
            border-radius: 10px;
            padding: 8px;
        }
        .schedule-table-container {
            margin: 30px 0 10px 0;
            background: #fafaff;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(44,62,80,0.06);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
            background: #ffffff;
            border: 1px solid #2c3e50;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #2c3e50;
            color: #2c3e50;
        }
        th {
            background: #eee;
        }
        @media (min-width: 768px) {
            #hamburger { display: none; }
            nav { display: block; }
            nav ul { flex-direction: row; }
            nav ul li { margin: 0 10px; }
            .youtube-container { flex-direction: row; }
        }
        @media (max-width: 767px) {
            .youtube-container { flex-direction: column; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Willowdale Basketball</h1>
        <div id="hamburger">&#9776;</div>
        <nav id="nav-menu">
            <ul>
                <li><a href="#home" data-section="home">Home</a></li>
                <li><a href="#roster" data-section="roster">Roster</a></li>
                <li><a href="#schedule" data-section="schedule">Schedule</a></li>
                <li><a href="#stats" data-section="stats">Stats</a></li>
                <li><a href="#gallery" data-section="gallery">Gallery</a></li>
                <li><a href="#admin" data-section="admin">Admin</a></li>
                <li><button type="button" id="dark-mode-toggle">Toggle Dark Mode</button></li>
            </ul>
        </nav>
    </header>
    <div id="main-content"></div>
    <script type="module">
    document.addEventListener('DOMContentLoaded', () => {
        // Hamburger menu
        const hamburger = document.getElementById('hamburger');
        const navMenu = document.getElementById('nav-menu');
        hamburger.onclick = function() {
            navMenu.style.display = (navMenu.style.display === 'block' ? 'none' : 'block');
        };

        // Navigation links
        document.querySelectorAll('#nav-menu ul li a[data-section]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                let section = this.getAttribute('data-section');
                window.location.hash = '#' + section;
                // Hide nav on mobile after click
                if (window.innerWidth < 768) {
                    navMenu.style.display = 'none';
                }
            });
        });

        // Dark mode toggle
        document.getElementById('dark-mode-toggle').onclick = function() {
            document.body.classList.toggle('dark-mode');
        };

        // SPA section loader
        async function loadSection(section) {
            // Home is now rendered in JS for interactivity (see below)
            if (section === "home") {
                renderHomeSection();
                return;
            }
            try {
                const res = await fetch(`sections/${section}.html`);
                if (!res.ok) throw new Error("Section not found");
                const html = await res.text();
                document.getElementById('main-content').innerHTML = html;
                callSectionRenderer(section);
            } catch (e) {
                document.getElementById('main-content').innerHTML = "<section><h2>Section not found</h2></section>";
            }
        }

        // Data storage from localStorage
        let news = JSON.parse(localStorage.getItem('news')) || [];
        let players = JSON.parse(localStorage.getItem('players')) || [];
        let games = JSON.parse(localStorage.getItem('games')) || [];
        let stats = JSON.parse(localStorage.getItem('stats')) || {};
        let gallery = JSON.parse(localStorage.getItem('gallery')) || [];
        let youtubeVideos = JSON.parse(localStorage.getItem('youtubeVideos')) || [
            // Default static videos
            "https://www.youtube.com/embed/Ke90Tje7VS0",
            "https://www.youtube.com/embed/dQw4w9WgXcQ"
        ];
        const adminPassword = 'admin123';

        // Section renderers
        function renderNewsSection(newsArr) {
            const feed = document.getElementById('news-feed');
            if (feed) {
                feed.innerHTML = '';
                newsArr.forEach(item => {
                    let p = document.createElement('p');
                    p.textContent = item;
                    feed.appendChild(p);
                });
            }
        }
        function renderRosterSection(playersArr) {
            const list = document.getElementById('roster-list');
            if (list) {
                list.innerHTML = '';
                playersArr.forEach(player => {
                    let card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `<h3>${player.name}</h3><p>${player.pos}</p><img src="${player.img}" alt="${player.name}" style="width:100%;"><p>${player.bio}</p>
                        <button type="button" onclick="shareLink('/player/${player.name.replace(/\s/g, '-')}')">Share Profile</button>`;
                    list.appendChild(card);
                });
            }
        }
        function renderScheduleSection(gamesArr) {
            const body = document.querySelector('#schedule-table tbody');
            if (body) {
                body.innerHTML = '';
                gamesArr.forEach(game => {
                    let row = document.createElement('tr');
                    row.innerHTML = `<td>${game.date}</td><td>${game.opp}</td><td>${game.loc}</td><td>${game.res}</td>`;
                    body.appendChild(row);
                });
            }
        }
        function renderStatsSection(statsObj) {
            const body = document.querySelector('#stats-table tbody');
            if (body) {
                body.innerHTML = '';
                for (let player in statsObj) {
                    let row = document.createElement('tr');
                    row.innerHTML = `<td>${player}</td><td>${statsObj[player].pts}</td><td>${statsObj[player].reb}</td><td>${statsObj[player].ast}</td>`;
                    body.appendChild(row);
                }
            }
        }
        function renderGallerySection(galleryArr) {
            const grid = document.getElementById('gallery-grid');
            if (grid) {
                grid.innerHTML = '';
                galleryArr.forEach(imgObj => {
                    let card = document.createElement('div');
                    card.className = 'card';
                    // galleryArr now uses {date, url}
                    card.innerHTML = `<img src="${imgObj.url}" alt="Gallery Image" style="width:100%;">`;
                    grid.appendChild(card);
                });
            }
        }
        function callSectionRenderer(sectionId) {
            switch (sectionId) {
                case 'home': renderHomeSection(); break;
                case 'roster': renderRosterSection(players); break;
                case 'schedule': renderScheduleSection(games); break;
                case 'stats': renderStatsSection(stats); break;
                case 'gallery': renderGallerySection(gallery); break;
            }
        }

        // Roster filter
        window.filterRoster = function() {
            let input = document.getElementById('roster-search').value.toLowerCase();
            let cards = document.querySelectorAll('#roster-list .card');
            cards.forEach(card => {
                let name = card.querySelector('h3').textContent.toLowerCase();
                card.style.display = name.includes(input) ? 'block' : 'none';
            });
        };
        // Admin login
        window.loginAdmin = function() {
            let pass = document.getElementById('admin-pass').value;
            if (pass === adminPassword) {
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-forms').style.display = 'block';
            } else {
                alert('Incorrect password');
            }
        };
        // Add news
        window.addNews = function() {
            let text = document.getElementById('news-text').value;
            if (text) {
                news.push(text);
                localStorage.setItem('news', JSON.stringify(news));
                renderNewsSection(news);
                document.getElementById('news-text').value = '';
            }
        };
        // Add player
        window.addPlayer = function() {
            let name = document.getElementById('player-name').value;
            let pos = document.getElementById('player-pos').value;
            let bio = document.getElementById('player-bio').value;
            let img = document.getElementById('player-img').value;
            if (name && pos) {
                players.push({name, pos, bio, img});
                localStorage.setItem('players', JSON.stringify(players));
                renderRosterSection(players);
                document.getElementById('player-name').value = '';
                document.getElementById('player-pos').value = '';
                document.getElementById('player-bio').value = '';
                document.getElementById('player-img').value = '';
            }
        };
        // Add game
        window.addGame = function() {
            let date = document.getElementById('game-date').value;
            let opp = document.getElementById('game-opp').value;
            let loc = document.getElementById('game-loc').value;
            let res = document.getElementById('game-res').value;
            if (date && opp) {
                games.push({date, opp, loc, res});
                localStorage.setItem('games', JSON.stringify(games));
                renderScheduleSection(games);
                document.getElementById('game-date').value = '';
                document.getElementById('game-opp').value = '';
                document.getElementById('game-loc').value = '';
                document.getElementById('game-res').value = '';
            }
        };
        // Update stats
        window.updateStats = function() {
            let player = document.getElementById('stats-player').value;
            let pts = document.getElementById('stats-pts').value;
            let reb = document.getElementById('stats-reb').value;
            let ast = document.getElementById('stats-ast').value;
            if (player) {
                stats[player] = {pts, reb, ast};
                localStorage.setItem('stats', JSON.stringify(stats));
                renderStatsSection(stats);
                document.getElementById('stats-player').value = '';
                document.getElementById('stats-pts').value = '';
                document.getElementById('stats-reb').value = '';
                document.getElementById('stats-ast').value = '';
            }
        };
        // Add image to gallery (now expects date + url object)
        window.addImage = function() {
            let img = document.getElementById('gallery-img').value;
            let date = document.getElementById('gallery-date') ? document.getElementById('gallery-date').value : "";
            if (img) {
                gallery.push({date, url: img});
                localStorage.setItem('gallery', JSON.stringify(gallery));
                renderGallerySection(gallery);
                document.getElementById('gallery-img').value = '';
                if(document.getElementById('gallery-date')) document.getElementById('gallery-date').value = '';
            }
        };
        // Export data as JSON
        window.exportData = function() {
            let data = {news, players, games, stats, gallery, youtubeVideos};
            let blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            let url = URL.createObjectURL(blob);
            let a = document.createElement('a');
            a.href = url;
            a.download = 'team-data.json';
            a.click();
        };
        // Share link
        window.shareLink = function(path) {
            let url = window.location.origin + path;
            if (navigator.share) {
                navigator.share({title: 'Share Profile', url});
            } else {
                alert('Share this link: ' + url);
            }
        };
        // Add YouTube video for admin
        window.addYouTubeVideo = function() {
            let url = document.getElementById('youtube-url').value;
            if (url) {
                // Ensure only 2 links are saved
                youtubeVideos.unshift(url);
                youtubeVideos = youtubeVideos.slice(0,2);
                localStorage.setItem('youtubeVideos', JSON.stringify(youtubeVideos));
                document.getElementById('youtube-url').value = '';
                renderHomeSection();
            }
        };

        // Interactive Home Section
        function renderHomeSection() {
            // Get videos (always 2, if less, fill with blanks)
            let videos = JSON.parse(localStorage.getItem('youtubeVideos')) || youtubeVideos;
            if (!Array.isArray(videos)) videos = [];
            while (videos.length < 2) videos.push("");
            // Games: show table with last 1 past game and all future games
            let now = new Date(), past = [], future = [];
            games.forEach(g => {
                let d = new Date(g.date);
                if (d < now) past.push(g);
                else future.push(g);
            });
            past.sort((a,b) => new Date(b.date)-new Date(a.date));
            future.sort((a,b) => new Date(a.date)-new Date(b.date));
            let recentPast = past.slice(0,1);
            let homeHtml = `
                <div class="youtube-container">
                    <div class="youtube-video">
                        <iframe width="100%" height="250" src="${videos[0]}" frameborder="0" allowfullscreen></iframe>
                        <div style="text-align:center;color:#888;font-size:0.9em;">Featured Video </div>
                    </div>
                    <div class="youtube-video">
                        <iframe width="100%" height="250" src="${videos[1]}" frameborder="0" allowfullscreen></iframe>
                        <div style="text-align:center;color:#888;font-size:0.9em;">Previous Video</div>
                    </div>
                </div>
                <div class="schedule-table-container">
                    <h3>Game Schedule & Results</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Opponent</th>
                                <th>Location</th>
                                <th>Result</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recentPast.map(g => `
                            <tr style="background:#ffe8e8;">
                                <td>${g.date}</td>
                                <td>${g.opp}</td>
                                <td>${g.loc}</td>
                                <td>${g.res || ""}</td>
                            </tr>
                            `).join("")}
                            ${future.map(g => `
                            <tr style="background:#e8f5ff;">
                                <td>${g.date}</td>
                                <td>${g.opp}</td>
                                <td>${g.loc}</td>
                                <td>${g.res || ""}</td>
                            </tr>
                            `).join("")}
                        </tbody>
                    </table>
                </div>
            `;
            document.getElementById('main-content').innerHTML = homeHtml;
        }

        // SPA hash navigation
        function onHashChange() {
            let section = (window.location.hash || '#home').replace(/^#/, '');
            loadSection(section);
        }
        window.addEventListener('hashchange', onHashChange);

        // Initial load
        onHashChange();
    });
    </script>
</body>
</html>